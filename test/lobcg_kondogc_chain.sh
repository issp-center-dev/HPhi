#!/bin/sh -e

mkdir -p lobcg_kondogc_chain/
cd lobcg_kondogc_chain

cat > stan.in <<EOF
L = 4
model = "KondoGC"
method = "CG"
lattice = "chain"
t = 1.0
J = 4.0
mu = 0.6
h = -0.2
exct = 3
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
 0
  -15.0776213781764330
  0.1072445462409950
  -0.0000000000000000

 1
  -13.6371064976052097
  1.0413195150782721
  -0.4999999999999999

 2
  -13.4371064976051855
  1.0413195150782717
  0.4999999999999998
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0856182891 -0.0000000000
 -0.0000000000 -0.0000000000
 0.0856182891 -0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0856182891 0.0000000000
 0.0000000000 -0.0000000000
 0.0856182891 0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
 0.3358463805 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.6641536195 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.6641536204 0.0000000000
 0.0836735739 0.0000000001
 -0.0153259847 0.0000000000
 0.0836735736 0.0000000002
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5858463679 0.0000000000
 0.1667004631 -0.0000000005
 0.0802293999 -0.0000000016
 0.1667004639 -0.0000000011
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
 0.6641536871 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.3358463129 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5858464068 0.0000000000
 0.1667004813 -0.0000000130
 0.0802294117 -0.0000000287
 0.1667004810 -0.0000000213
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.6641536778 0.0000000000
 0.0836735687 0.0000000012
 -0.0153259778 -0.0000000012
 0.0836735725 0.0000000075
EOF
paste output/zvo_cisajs_eigen2.dat reference.dat > paste4.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste4.dat`
echo "Diff output/zvo_cisajs_eigen2.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.2334100529 0.0000000000
 0.2665899471 0.0000000000
 0.2520581283 0.0000000000
 0.2479418717 0.0000000000
 0.2334100529 0.0000000000
 0.2665899471 0.0000000000
 0.0144223177 0.0000000000
 0.4855776823 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.2484110693 0.0000000000
 0.2515889307 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.5000000000 0.0000000000
 -0.0331798943 0.0000000000
 0.0041162566 -0.0000000000
 -0.0331798943 0.0000000000
 -0.4711553647 0.0000000000
 0.0182883790 -0.0000000000
 -0.0031778614 0.0000000000
 0.0182883790 -0.0000000000
 0.5000000000 0.0000000000
 -0.0331798943 -0.0000000000
 0.0041162566 0.0000000000
 -0.0331798943 -0.0000000000
 -0.4711553647 -0.0000000000
 0.0182883790 0.0000000000
 -0.0031778614 -0.0000000000
 0.0182883790 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.2665899471 0.0000000000
 0.2334100529 0.0000000000
 0.2479418717 0.0000000000
 0.2520581283 0.0000000000
 0.2665899471 0.0000000000
 0.2334100529 0.0000000000
 0.4855776823 0.0000000000
 0.0144223177 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.2515889307 0.0000000000
 0.2484110693 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.0144223177 0.0000000000
 0.4855776823 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.2484110693 0.0000000000
 0.2515889307 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.5000000000 0.0000000000
 0.0268111366 0.0000000000
 0.2341148537 0.0000000000
 0.2529380156 0.0000000000
 0.2506485267 0.0000000000
 0.2484345981 0.0000000000
 0.2341148537 0.0000000000
 0.2529380156 0.0000000000
 -0.4711553647 -0.0000000000
 0.0182883790 -0.0000000000
 -0.0031778614 0.0000000000
 0.0182883790 -0.0000000000
 0.4731888634 0.0000000000
 -0.0188231620 0.0000000000
 0.0022139286 -0.0000000000
 -0.0188231620 0.0000000000
 -0.4711553647 0.0000000000
 0.0182883790 0.0000000000
 -0.0031778614 -0.0000000000
 0.0182883790 0.0000000000
 0.4731888634 0.0000000000
 -0.0188231620 -0.0000000000
 0.0022139286 0.0000000000
 -0.0188231620 -0.0000000000
 0.4855776823 0.0000000000
 0.0144223177 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.2515889307 0.0000000000
 0.2484110693 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.0268111366 0.0000000000
 0.5000000000 0.0000000000
 0.2529380156 0.0000000000
 0.2341148537 0.0000000000
 0.2484345981 0.0000000000
 0.2506485267 0.0000000000
 0.2529380156 0.0000000000
 0.2341148537 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
 0.3358463805 0.0000000000
 0.0000000000 0.0000000000
 0.1027409995 0.0000000000
 0.2331053810 0.0000000000
 0.0817314672 0.0000000000
 0.2541149133 0.0000000000
 0.1027409988 0.0000000000
 0.2331053817 0.0000000000
 0.0158318538 0.0000000000
 0.3322663246 0.0000000000
 0.2265432027 0.0000000000
 0.2068756783 0.0000000000
 0.2514074162 0.0000000000
 0.2128885447 0.0000000000
 0.2265432033 0.0000000000
 0.2068756791 0.0000000000
 0.3358463805 0.0000000000
 0.0337892453 0.0000000001
 -0.0082298116 -0.0000000001
 0.0337892457 0.0000000011
 -0.3555880970 -0.0000000002
 -0.0194861030 0.0000000001
 -0.0006347569 0.0000000000
 -0.0194861034 -0.0000000006
 0.6641536195 0.0000000000
 0.0337892453 -0.0000000001
 -0.0082298116 0.0000000001
 0.0337892457 -0.0000000011
 -0.3555880970 0.0000000002
 -0.0194861030 -0.0000000001
 -0.0006347569 -0.0000000000
 -0.0194861034 0.0000000006
 0.0000000000 0.0000000000
 0.6641536195 0.0000000000
 0.2331053736 0.0000000000
 0.4310482458 0.0000000000
 0.2541148986 0.0000000000
 0.4100387209 0.0000000000
 0.2331053722 0.0000000000
 0.4310482472 0.0000000000
 0.6483217666 0.0000000000
 0.2535800434 0.0000000000
 0.4376104240 0.0000000000
 0.3789706936 0.0000000000
 0.4127462176 0.0000000000
 0.3729578328 0.0000000000
 0.4376104252 0.0000000000
 0.3789706941 0.0000000000
 0.0158318538 0.0000000000
 0.6483217666 0.0000000000
 0.2265431958 0.0000000000
 0.4376104246 0.0000000000
 0.2514074020 0.0000000000
 0.4127462184 0.0000000000
 0.2265431945 0.0000000000
 0.4376104259 0.0000000000
 0.6641536204 0.0000000000
 0.2603298673 0.0000000000
 0.4288024430 0.0000000000
 0.3754681078 0.0000000000
 0.4145303279 0.0000000000
 0.3732131829 0.0000000000
 0.4288024442 0.0000000000
 0.3754681085 0.0000000000
 -0.3555880970 0.0000000002
 -0.0194861026 -0.0000000002
 -0.0006347567 -0.0000000001
 -0.0194861027 -0.0000000005
 0.4038237531 0.0000000000
 -0.0055657280 -0.0000000000
 0.0025027622 0.0000000001
 -0.0055657279 0.0000000001
 -0.3555880970 -0.0000000002
 -0.0194861026 0.0000000002
 -0.0006347567 0.0000000001
 -0.0194861027 0.0000000005
 0.3255165006 0.0000000000
 -0.0055657280 0.0000000000
 0.0025027622 -0.0000000001
 -0.0055657279 -0.0000000001
 0.3322663246 0.0000000000
 0.2535800434 0.0000000000
 0.2068756722 0.0000000000
 0.3789706957 0.0000000000
 0.2128885326 0.0000000000
 0.3729578354 0.0000000000
 0.2068756712 0.0000000000
 0.3789706967 0.0000000000
 0.2603298673 0.0000000000
 0.5858463679 0.0000000000
 0.3754681092 0.0000000000
 0.3110023179 0.0000000000
 0.3732131847 0.0000000000
 0.3369015641 0.0000000000
 0.3754681100 0.0000000000
 0.3110023185 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
 0.6641536871 0.0000000000
 0.0000000000 0.0000000000
 0.4310482833 0.0000000000
 0.2331054038 0.0000000000
 0.4100387345 0.0000000000
 0.2541149526 0.0000000000
 0.4310482753 0.0000000000
 0.2331054118 0.0000000000
 0.2535801487 0.0000000000
 0.6483218304 0.0000000000
 0.3789707267 0.0000000000
 0.4376104622 0.0000000000
 0.3729578533 0.0000000000
 0.4127462314 0.0000000000
 0.3789707265 0.0000000000
 0.4376104562 0.0000000000
 0.6641536871 0.0000000000
 0.0337892554 -0.0000000041
 -0.0082298031 0.0000000011
 0.0337892525 -0.0000000214
 -0.3555880460 0.0000000099
 -0.0194861055 0.0000000003
 -0.0006347619 -0.0000000008
 -0.0194861044 0.0000000104
 0.3358463129 0.0000000000
 0.0337892554 0.0000000041
 -0.0082298031 -0.0000000011
 0.0337892525 0.0000000214
 -0.3555880460 -0.0000000099
 -0.0194861055 -0.0000000003
 -0.0006347619 0.0000000008
 -0.0194861044 -0.0000000104
 0.0000000000 0.0000000000
 0.3358463129 0.0000000000
 0.2331053384 0.0000000000
 0.1027409745 0.0000000000
 0.2541148554 0.0000000000
 0.0817314576 0.0000000000
 0.2331053310 0.0000000000
 0.1027409819 0.0000000000
 0.3322662581 0.0000000000
 0.0158318475 0.0000000000
 0.2068756430 0.0000000000
 0.2265431631 0.0000000000
 0.2128884983 0.0000000000
 0.2514073589 0.0000000000
 0.2068756403 0.0000000000
 0.2265431554 0.0000000000
 0.2535801487 0.0000000000
 0.3322662581 0.0000000000
 0.3789707084 0.0000000000
 0.2068756984 0.0000000000
 0.3729578313 0.0000000000
 0.2128885756 0.0000000000
 0.3789707016 0.0000000000
 0.2068757052 0.0000000000
 0.5858464068 0.0000000000
 0.2603299622 0.0000000000
 0.3110023353 0.0000000000
 0.3754681270 0.0000000000
 0.3369015704 0.0000000000
 0.3732131810 0.0000000000
 0.3110023315 0.0000000000
 0.3754681199 0.0000000000
 -0.3555880460 -0.0000000099
 -0.0194861115 0.0000000028
 -0.0006347602 0.0000000037
 -0.0194861094 0.0000000106
 0.3255164447 0.0000000000
 -0.0055657255 0.0000000005
 0.0025027636 -0.0000000020
 -0.0055657270 -0.0000000007
 -0.3555880460 0.0000000099
 -0.0194861115 -0.0000000028
 -0.0006347602 -0.0000000037
 -0.0194861094 -0.0000000106
 0.4038237157 0.0000000000
 -0.0055657255 -0.0000000005
 0.0025027636 0.0000000020
 -0.0055657270 0.0000000007
 0.6483218304 0.0000000000
 0.0158318475 0.0000000000
 0.4376104554 0.0000000000
 0.2265432225 0.0000000000
 0.4127462255 0.0000000000
 0.2514074524 0.0000000000
 0.4376104487 0.0000000000
 0.2265432291 0.0000000000
 0.2603299622 0.0000000000
 0.6641536778 0.0000000000
 0.3754681348 0.0000000000
 0.4288024765 0.0000000000
 0.3732131980 0.0000000000
 0.4145303356 0.0000000000
 0.3754681343 0.0000000000
 0.4288024700 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen2.dat reference.dat > paste7.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste7.dat`
echo "Diff output/zvo_cisajscktalt_eigen2.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
