#!/bin/sh -e

mkdir -p lobcg_kondogc_chain/
cd lobcg_kondogc_chain

cat > stan.in <<EOF
L = 4
model = "KondoGC"
method = "CG"
lattice = "chain"
t = 1.0
J = 4.0
mu = 0.6
h = -0.2
exct = 3
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
 0
  -15.0776213781764330
  0.1072445462409950
  -0.0000000000000000

 1
  -13.6371064976052097
  1.0413195150782721
  -0.4999999999999999

 2
  -13.4371064976051855
  1.0413195150782717
  0.4999999999999998
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0856182891 0.0000000000
   0.5000000000 0.0000000000
   0.0856182891 -0.0000000000
   -0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0856182891 -0.0000000000
   0.5000000000 0.0000000000
   0.0856182891 0.0000000000
   -0.0000000000 -0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.3358463805 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.6641536195 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0836735739 -0.0000000001
   0.6641536268 0.0000000000
   0.0836735737 -0.0000000001
   -0.0153259840 0.0000000003
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.1667004632 0.0000000005
   0.5858463718 0.0000000000
   0.1667004682 -0.0000000011
   0.0802294006 -0.0000000014
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.6641536871 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.3358463129 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.1667004814 0.0000000130
   0.5858463697 0.0000000000
   0.1667004534 -0.0000000141
   0.0802293911 -0.0000000154
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0836735687 -0.0000000012
   0.6641536253 0.0000000000
   0.0836735700 -0.0000000001
   -0.0153259877 0.0000000038
EOF
paste output/zvo_cisajs_eigen2.dat reference.dat > paste4.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste4.dat`
echo "Diff output/zvo_cisajs_eigen2.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.2334100529 0.0000000000
   0.2665899471 0.0000000000
   0.2520581283 0.0000000000
   0.2479418717 0.0000000000
   0.2334100529 0.0000000000
   0.2665899471 0.0000000000
   0.0144223177 0.0000000000
   0.4855776823 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.2484110693 0.0000000000
   0.2515889307 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.5000000000 0.0000000000
   -0.0331798943 0.0000000000
   0.0041162566 -0.0000000000
   -0.0331798943 0.0000000000
   -0.4711553647 0.0000000000
   0.0182883790 -0.0000000000
   -0.0031778614 0.0000000000
   0.0182883790 -0.0000000000
   0.5000000000 0.0000000000
   -0.0331798943 -0.0000000000
   0.0041162566 0.0000000000
   -0.0331798943 -0.0000000000
   -0.4711553647 -0.0000000000
   0.0182883790 0.0000000000
   -0.0031778614 -0.0000000000
   0.0182883790 0.0000000000
   0.0000000000 0.0000000000
   0.5000000000 0.0000000000
   0.2665899471 0.0000000000
   0.2334100529 0.0000000000
   0.2479418717 0.0000000000
   0.2520581283 0.0000000000
   0.2665899471 0.0000000000
   0.2334100529 0.0000000000
   0.4855776823 0.0000000000
   0.0144223177 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2515889307 0.0000000000
   0.2484110693 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.0144223177 0.0000000000
   0.4855776823 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.2484110693 0.0000000000
   0.2515889307 0.0000000000
   0.2341148537 0.0000000000
   0.2529380156 0.0000000000
   0.5000000000 0.0000000000
   0.0268111366 0.0000000000
   0.2341148537 0.0000000000
   0.2529380156 0.0000000000
   0.2506485267 0.0000000000
   0.2484345981 0.0000000000
   0.0182883790 0.0000000000
   -0.4711553647 0.0000000000
   0.0182883790 -0.0000000000
   -0.0031778614 0.0000000000
   -0.0188231620 -0.0000000000
   0.4731888634 0.0000000000
   -0.0188231620 0.0000000000
   0.0022139286 -0.0000000000
   0.0182883790 -0.0000000000
   -0.4711553647 -0.0000000000
   0.0182883790 0.0000000000
   -0.0031778614 -0.0000000000
   -0.0188231620 0.0000000000
   0.4731888634 0.0000000000
   -0.0188231620 -0.0000000000
   0.0022139286 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.4855776823 0.0000000000
   0.0144223177 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2515889307 0.0000000000
   0.2484110693 0.0000000000
   0.2529380156 0.0000000000
   0.2341148537 0.0000000000
   0.0268111366 0.0000000000
   0.5000000000 0.0000000000
   0.2529380156 0.0000000000
   0.2341148537 0.0000000000
   0.2484345981 0.0000000000
   0.2506485267 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.3358463805 0.0000000000
   0.0000000000 0.0000000000
   0.1027409995 0.0000000000
   0.2331053810 0.0000000000
   0.0817314672 0.0000000000
   0.2541149133 0.0000000000
   0.1027409988 0.0000000000
   0.2331053817 0.0000000000
   0.0158318538 0.0000000000
   0.3322663246 0.0000000000
   0.2265432027 0.0000000000
   0.2068756783 0.0000000000
   0.2514074162 0.0000000000
   0.2128885447 0.0000000000
   0.2265432033 0.0000000000
   0.2068756791 0.0000000000
   0.3358463805 0.0000000000
   0.0337892453 0.0000000001
   -0.0082298116 -0.0000000001
   0.0337892457 0.0000000011
   -0.3555880970 -0.0000000002
   -0.0194861030 0.0000000001
   -0.0006347570 0.0000000000
   -0.0194861034 -0.0000000006
   0.6641536195 0.0000000000
   0.0337892453 -0.0000000001
   -0.0082298116 0.0000000001
   0.0337892457 -0.0000000011
   -0.3555880970 0.0000000002
   -0.0194861030 -0.0000000001
   -0.0006347570 -0.0000000000
   -0.0194861034 0.0000000006
   0.0000000000 0.0000000000
   0.6641536195 0.0000000000
   0.2331053736 0.0000000000
   0.4310482458 0.0000000000
   0.2541148986 0.0000000000
   0.4100387209 0.0000000000
   0.2331053722 0.0000000000
   0.4310482472 0.0000000000
   0.6483217666 0.0000000000
   0.2535800434 0.0000000000
   0.4376104240 0.0000000000
   0.3789706936 0.0000000000
   0.4127462176 0.0000000000
   0.3729578328 0.0000000000
   0.4376104252 0.0000000000
   0.3789706941 0.0000000000
   0.2265432027 0.0000000000
   0.4376104240 0.0000000000
   0.0158318533 0.0000000000
   0.6483217735 0.0000000000
   0.2265431939 0.0000000000
   0.4376104329 0.0000000000
   0.2514074076 0.0000000000
   0.4127462191 0.0000000000
   0.4288024430 0.0000000000
   0.3754681092 0.0000000000
   0.6641536268 0.0000000000
   0.2603298774 0.0000000000
   0.4288024511 0.0000000000
   0.3754681139 0.0000000000
   0.4145303286 0.0000000000
   0.3732131838 0.0000000000
   -0.0194861030 -0.0000000001
   -0.3555880914 0.0000000001
   -0.0194861044 -0.0000000004
   -0.0006347572 -0.0000000001
   -0.0055657280 0.0000000000
   0.4038237493 0.0000000000
   -0.0055657275 0.0000000001
   0.0025027624 0.0000000001
   -0.0194861030 0.0000000001
   -0.3555880914 -0.0000000001
   -0.0194861044 0.0000000004
   -0.0006347572 0.0000000001
   -0.0055657280 -0.0000000000
   0.3255164944 0.0000000000
   -0.0055657275 -0.0000000001
   0.0025027624 -0.0000000001
   0.2068756783 0.0000000000
   0.3789706936 0.0000000000
   0.3322663173 0.0000000000
   0.2535800545 0.0000000000
   0.2068756708 0.0000000000
   0.3789707011 0.0000000000
   0.2128885372 0.0000000000
   0.3729578346 0.0000000000
   0.3754681078 0.0000000000
   0.3110023179 0.0000000000
   0.2603298774 0.0000000000
   0.5858463718 0.0000000000
   0.3754681145 0.0000000000
   0.3110023219 0.0000000000
   0.3732131839 0.0000000000
   0.3369015637 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.6641536871 0.0000000000
   0.0000000000 0.0000000000
   0.4310482834 0.0000000000
   0.2331054037 0.0000000000
   0.4100387345 0.0000000000
   0.2541149526 0.0000000000
   0.4310482752 0.0000000000
   0.2331054119 0.0000000000
   0.2535801488 0.0000000000
   0.6483218304 0.0000000000
   0.3789707267 0.0000000000
   0.4376104622 0.0000000000
   0.3729578533 0.0000000000
   0.4127462314 0.0000000000
   0.3789707265 0.0000000000
   0.4376104562 0.0000000000
   0.6641536871 0.0000000000
   0.0337892554 -0.0000000041
   -0.0082298031 0.0000000011
   0.0337892524 -0.0000000214
   -0.3555880460 0.0000000099
   -0.0194861055 0.0000000003
   -0.0006347619 -0.0000000008
   -0.0194861044 0.0000000104
   0.3358463129 0.0000000000
   0.0337892554 0.0000000041
   -0.0082298031 -0.0000000011
   0.0337892524 0.0000000214
   -0.3555880460 -0.0000000099
   -0.0194861055 -0.0000000003
   -0.0006347619 0.0000000008
   -0.0194861044 -0.0000000104
   0.0000000000 0.0000000000
   0.3358463129 0.0000000000
   0.2331053384 0.0000000000
   0.1027409744 0.0000000000
   0.2541148553 0.0000000000
   0.0817314575 0.0000000000
   0.2331053310 0.0000000000
   0.1027409819 0.0000000000
   0.3322662581 0.0000000000
   0.0158318475 0.0000000000
   0.2068756430 0.0000000000
   0.2265431631 0.0000000000
   0.2128884983 0.0000000000
   0.2514073589 0.0000000000
   0.2068756403 0.0000000000
   0.2265431553 0.0000000000
   0.3789707267 0.0000000000
   0.2068756430 0.0000000000
   0.2535800469 0.0000000000
   0.3322663228 0.0000000000
   0.3789706782 0.0000000000
   0.2068756916 0.0000000000
   0.3729578218 0.0000000000
   0.2128885479 0.0000000000
   0.3110023354 0.0000000000
   0.3754681348 0.0000000000
   0.5858463697 0.0000000000
   0.2603298724 0.0000000000
   0.3110023103 0.0000000000
   0.3754680921 0.0000000000
   0.3369015596 0.0000000000
   0.3732131743 0.0000000000
   -0.0194861055 -0.0000000003
   -0.3555880967 -0.0000000014
   -0.0194860963 0.0000000057
   -0.0006347506 0.0000000039
   -0.0055657255 -0.0000000005
   0.3255164973 0.0000000000
   -0.0055657299 -0.0000000013
   0.0025027603 -0.0000000017
   -0.0194861055 0.0000000003
   -0.3555880967 0.0000000014
   -0.0194860963 -0.0000000057
   -0.0006347506 -0.0000000039
   -0.0055657255 0.0000000005
   0.4038237530 0.0000000000
   -0.0055657299 0.0000000013
   0.0025027603 0.0000000017
   0.4376104622 0.0000000000
   0.2265431631 0.0000000000
   0.6483217721 0.0000000000
   0.0158318532 0.0000000000
   0.4376104051 0.0000000000
   0.2265432203 0.0000000000
   0.4127462050 0.0000000000
   0.2514074203 0.0000000000
   0.3754681270 0.0000000000
   0.4288024766 0.0000000000
   0.2603298724 0.0000000000
   0.6641536253 0.0000000000
   0.3754681006 0.0000000000
   0.4288024246 0.0000000000
   0.3732131823 0.0000000000
   0.4145303179 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen2.dat reference.dat > paste7.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste7.dat`
echo "Diff output/zvo_cisajscktalt_eigen2.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
