#!/bin/sh -e

mkdir -p lobcg_kondo_chain/
cd lobcg_kondo_chain

cat > stan.in <<EOF
L = 4
model = "Kondo"
method = "CG"
lattice = "chain"
t = 1.0
J = 4.0
nelec = 4
2Sz = 0
exct = 2
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
 0
  -12.6776213781764220 
  0.1072445462409922 
  0.0000000000000000 

 1
  -9.8347989641820277 
  0.4289751043491778 
  0.0000000000000000 
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0856182891 0.0000000000
 0.0000000000 0.0000000000
 0.0856182891 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.0856182891 -0.0000000000
 -0.0000000000 0.0000000000
 0.0856182891 0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
 0.5000000022 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.4999999978 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.4999999922 0.0000000000
 0.1869257771 0.0000000017
 -0.0000000071 -0.0000000506
 0.1869257705 -0.0000000266
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.0000000000 0.0000000000
 0.4999999839 0.0000000000
 0.1869257740 -0.0000000353
 -0.0000000023 -0.0000000494
 0.1869257727 0.0000000184
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
 0.5000000000 0.0000000000
 0.0000000000 0.0000000000
 0.2334100529 0.0000000000
 0.2665899471 0.0000000000
 0.2520581283 0.0000000000
 0.2479418717 0.0000000000
 0.2334100529 0.0000000000
 0.2665899471 0.0000000000
 0.0144223177 0.0000000000
 0.4855776823 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.2484110693 0.0000000000
 0.2515889307 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.5000000000 0.0000000000
 -0.0331798943 -0.0000000000
 0.0041162566 -0.0000000000
 -0.0331798943 0.0000000000
 -0.4711553647 0.0000000000
 0.0182883790 0.0000000000
 -0.0031778614 -0.0000000000
 0.0182883790 -0.0000000000
 0.5000000000 0.0000000000
 -0.0331798943 0.0000000000
 0.0041162566 0.0000000000
 -0.0331798943 -0.0000000000
 -0.4711553647 -0.0000000000
 0.0182883790 -0.0000000000
 -0.0031778614 0.0000000000
 0.0182883790 0.0000000000
 0.0000000000 0.0000000000
 0.5000000000 0.0000000000
 0.2665899471 0.0000000000
 0.2334100529 0.0000000000
 0.2479418717 0.0000000000
 0.2520581283 0.0000000000
 0.2665899471 0.0000000000
 0.2334100529 0.0000000000
 0.4855776823 0.0000000000
 0.0144223177 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.2515889307 0.0000000000
 0.2484110693 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.0144223177 0.0000000000
 0.4855776823 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.2484110693 0.0000000000
 0.2515889307 0.0000000000
 0.2591441895 0.0000000000
 0.2408558105 0.0000000000
 0.5000000000 0.0000000000
 0.0268111366 0.0000000000
 0.2341148537 0.0000000000
 0.2529380156 0.0000000000
 0.2506485267 0.0000000000
 0.2484345981 0.0000000000
 0.2341148537 0.0000000000
 0.2529380156 0.0000000000
 -0.4711553647 -0.0000000000
 0.0182883790 0.0000000000
 -0.0031778614 0.0000000000
 0.0182883790 -0.0000000000
 0.4731888634 0.0000000000
 -0.0188231620 -0.0000000000
 0.0022139286 -0.0000000000
 -0.0188231620 0.0000000000
 -0.4711553647 0.0000000000
 0.0182883790 -0.0000000000
 -0.0031778614 -0.0000000000
 0.0182883790 0.0000000000
 0.4731888634 0.0000000000
 -0.0188231620 0.0000000000
 0.0022139286 0.0000000000
 -0.0188231620 -0.0000000000
 0.4855776823 0.0000000000
 0.0144223177 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.2515889307 0.0000000000
 0.2484110693 0.0000000000
 0.2408558105 0.0000000000
 0.2591441895 0.0000000000
 0.0268111366 0.0000000000
 0.5000000000 0.0000000000
 0.2529380156 0.0000000000
 0.2341148537 0.0000000000
 0.2484345981 0.0000000000
 0.2506485267 0.0000000000
 0.2529380156 0.0000000000
 0.2341148537 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
  0.5000000022 0.0000000000
  0.0000000000 0.0000000000
  0.1340006459 0.0000000000
  0.3659993563 0.0000000000
  0.3498888304 0.0000000000
  0.1501111718 0.0000000000
  0.1340006188 0.0000000000
  0.3659993834 0.0000000000
  0.0631654874 0.0000000000
  0.4368345029 0.0000000000
  0.3285310533 0.0000000000
  0.1714689515 0.0000000000
  0.1618823126 0.0000000000
  0.3381176870 0.0000000000
  0.3285310581 0.0000000000
  0.1714689558 0.0000000000
  0.5000000022 0.0000000000
  0.1083653322 0.0000000534
  0.0422011973 0.0000000013
  0.1083653406 -0.0000000415
  -0.2409145556 0.0000000169
  -0.0103254757 -0.0000000066
  -0.0266359304 0.0000000069
  -0.0103254831 -0.0000000015
  0.4999999978 0.0000000000
  0.1083653322 -0.0000000534
  0.0422011973 -0.0000000013
  0.1083653406 0.0000000415
  -0.2409145556 -0.0000000169
  -0.0103254757 0.0000000066
  -0.0266359304 -0.0000000069
  -0.0103254831 0.0000000015
  0.0000000000 0.0000000000
  0.4999999978 0.0000000000
  0.3659993864 0.0000000000
  0.1340006114 0.0000000000
  0.1501111758 0.0000000000
  0.3498888220 0.0000000000
  0.3659993379 0.0000000000
  0.1340006599 0.0000000000
  0.4368345048 0.0000000000
  0.0631654810 0.0000000000
  0.1714689378 0.0000000000
  0.3285310622 0.0000000000
  0.3381176928 0.0000000000
  0.1618823021 0.0000000000
  0.1714689559 0.0000000000
  0.3285310548 0.0000000000
  0.0631654874 0.0000000000
  0.4368345048 0.0000000000
  0.3285310709 0.0000000000
  0.1714689213 0.0000000000
  0.1618823020 0.0000000000
  0.3381176902 0.0000000000
  0.3285310236 0.0000000000
  0.1714689687 0.0000000000
  0.4999999922 0.0000000000
  0.1072437852 0.0000000000
  0.1520225988 0.0000000000
  0.3026584418 0.0000000000
  0.3138448750 0.0000000000
  0.1695492188 0.0000000000
  0.1520226189 0.0000000000
  0.3026584381 0.0000000000
  -0.2409145556 -0.0000000169
  -0.0103254609 -0.0000000100
  -0.0266359295 -0.0000000083
  -0.0103254645 0.0000000017
  0.3927562070 0.0000000000
  -0.0443381876 -0.0000000107
  0.0133913825 -0.0000000002
  -0.0443381890 0.0000000084
  -0.2409145556 0.0000000169
  -0.0103254609 0.0000000100
  -0.0266359295 0.0000000083
  -0.0103254645 -0.0000000017
  0.3927561987 0.0000000000
  -0.0443381876 0.0000000107
  0.0133913825 0.0000000002
  -0.0443381890 -0.0000000084
  0.4368345029 0.0000000000
  0.0631654810 0.0000000000
  0.1714689498 0.0000000000
  0.3285310341 0.0000000000
  0.3381176897 0.0000000000
  0.1618822942 0.0000000000
  0.1714689221 0.0000000000
  0.3285310618 0.0000000000
  0.1072437852 0.0000000000
  0.4999999839 0.0000000000
  0.3026584266 0.0000000000
  0.1520226076 0.0000000000
  0.1695492247 0.0000000000
  0.3138448626 0.0000000000
  0.3026584347 0.0000000000
  0.1520226104 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
