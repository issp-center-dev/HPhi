#!/bin/sh -e

mkdir -p lobcg_hubbardgc_tri/
cd lobcg_hubbardgc_tri

cat > stan.in <<EOF
a0w = 3
a0l = 0
a1w = -1
a1l = 2
model = "HubbardGC"
method = "CG"
lattice = "Triangular"
t = 1.0
U = 4.0
h = -3.0
exct = 2
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
   0
 -15.3140744040600296
   0.3472086205791794
  -1.0000000000000004

   1
 -14.2336534858459416
   0.4631929500975011
  -1.4999999999999998
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
   0.1666666667 0.0000000000
   0.1621699668 0.0000000000
   0.1621699668 0.0000000000
   0.1613929654 -0.0000000000
   0.1609879895 0.0000000000
   0.1613929654 0.0000000000
   0.5000000000 0.0000000000
   0.0006406864 -0.0000000000
   0.0006406864 -0.0000000000
   0.3281562449 -0.0000000000
   -0.1621362730 0.0000000000
   0.3281562449 -0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.1666666535 0.0000000000
   0.1565351556 0.0000000069
   0.1565351515 0.0000000060
   0.1602483214 0.0000000007
   0.1519552255 0.0000000085
   0.1602483168 0.0000000018
   0.6666666987 0.0000000000
   0.1597659656 -0.0000001136
   0.1597659838 -0.0000000866
   0.1643688146 0.0000000489
   -0.3186122354 0.0000001338
   0.1643688050 0.0000000186
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
   0.1666666667 0.0000000000
   0.0578681034 0.0000000000
   0.0000000000 0.0000000000
   0.0840367622 0.0000000000
   0.0000000000 0.0000000000
   0.0840367622 0.0000000000
   0.0000000000 0.0000000000
   0.0924923569 0.0000000000
   0.0000000000 0.0000000000
   0.0890736583 0.0000000000
   0.0000000000 0.0000000000
   0.0924923569 0.0000000000
   0.1087985632 0.0000000000
   -0.0009539283 -0.0000000000
   -0.0009539283 -0.0000000000
   -0.0721883906 -0.0000000000
   0.0374860746 0.0000000000
   -0.0721883906 -0.0000000000
   0.4421318966 0.0000000000
   -0.0009539283 0.0000000000
   -0.0009539283 0.0000000000
   -0.0721883906 0.0000000000
   0.0374860746 -0.0000000000
   -0.0721883906 0.0000000000
   0.0578681034 0.0000000000
   0.5000000000 0.0000000000
   0.0840367622 0.0000000000
   0.2493085242 0.0000000000
   0.0840367622 0.0000000000
   0.2493085242 0.0000000000
   0.0924923569 0.0000000000
   0.1397007119 0.0000000000
   0.0890736583 0.0000000000
   0.2219815277 0.0000000000
   0.0924923569 0.0000000000
   0.1397007119 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.1666666535 0.0000000000
   0.0771988246 0.0000000000
   0.0000000000 0.0000000000
   0.1175311767 0.0000000000
   0.0000000000 0.0000000000
   0.1175311865 0.0000000000
   0.0000000000 0.0000000000
   0.1102842057 0.0000000000
   0.0000000000 0.0000000000
   0.1338370070 0.0000000000
   0.0000000000 0.0000000000
   0.1102842135 0.0000000000
   0.0894678289 0.0000000000
   -0.0447339185 -0.0000000342
   -0.0447339242 -0.0000000251
   -0.0446979144 0.0000000134
   0.0893958371 0.0000000433
   -0.0446979105 0.0000000037
   0.5894678742 0.0000000000
   -0.0447339185 0.0000000342
   -0.0447339242 0.0000000251
   -0.0446979144 -0.0000000134
   0.0893958371 -0.0000000433
   -0.0446979105 -0.0000000037
   0.0771988246 0.0000000000
   0.6666666987 0.0000000000
   0.1175312031 0.0000000000
   0.4155829429 0.0000000000
   0.1175311988 0.0000000000
   0.4155829709 0.0000000000
   0.1102842222 0.0000000000
   0.4176514173 0.0000000000
   0.1338370346 0.0000000000
   0.3335313104 0.0000000000
   0.1102842155 0.0000000000
   0.4176514547 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
