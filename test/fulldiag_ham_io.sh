#!/bin/sh -e

mkdir -p fulldiag_ham_io/
cd fulldiag_ham_io

cat > stan1.in <<EOF
L = 4
model = "FermionHubbard"
method = "FullDiag"
lattice = "chain"
t = 1.0
U = 4.0
nelec = 4
2Sz = 0
HamIO = "out"
EOF

${MPIRUNFC} ../../src/HPhi -s stan1.in

cat > stan2.in <<EOF
L = 4
model = "FermionHubbard"
method = "FullDiag"
lattice = "chain"
t = 1.0
U = 4.0
nelec = 4
2Sz = 0
HamIO = "in"
EOF

${MPIRUNFC} ../../src/HPhi -s stan2.in

# Check value

cat > reference.dat <<EOF
  <H>         <N>        <Sz>       <S2>       <D> 
  -2.102748   4.000000  -0.000000   0.000000   0.287325
  -1.806424   4.000000  -0.000000   2.000000   0.335409
  -1.068140   4.000000   0.000000   0.000000   0.277708
  -0.828427   4.000000  -0.000000   2.000000   0.146447
  -0.828427   4.000000  -0.000000   2.000000   0.146447
   0.000000   4.000000   0.000000   6.000000   0.000000
   0.581449   4.000000  -0.000000   0.000000   1.079437
   2.000000   4.000000  -0.000000   0.766731   1.000000
   2.000000   4.000000   0.000000   0.594352   1.000000
   2.000000   4.000000  -0.000000   1.135105   1.000000
   2.000000   4.000000   0.000000   1.503811   1.000000
   2.387873   4.000000   0.000000   2.000000   0.744028
   2.965392   4.000000  -0.000000  -0.000000   1.009617
   3.171573   4.000000  -0.000000   0.000000   1.146447
   3.171573   4.000000   0.000000   0.000000   1.146447
   4.000000   4.000000   0.000000   1.553353   1.000000
   4.000000   4.000000   0.000000   1.046321   1.000000
   4.000000   4.000000  -0.000000   1.875964   1.000000
   4.000000   4.000000   0.000000   1.364073   1.000000
   4.000000   4.000000  -0.000000   1.119177   1.000000
   4.000000   4.000000  -0.000000   1.041113   1.000000
   4.828427   4.000000   0.000000   2.000000   0.853553
   4.828427   4.000000   0.000000   2.000000   0.853553
   5.034608   4.000000  -0.000000   0.000000   0.990383
   5.612127   4.000000  -0.000000  -0.000000   1.255972
   6.000000   4.000000  -0.000000   1.247961   1.000000
   6.000000   4.000000   0.000000   0.904046   1.000000
   6.000000   4.000000  -0.000000   0.145072   1.000000
   6.000000   4.000000   0.000000   1.702920   1.000000
   7.418551   4.000000   0.000000   2.000000   0.920563
   8.000000   4.000000   0.000000   0.000000   2.000000
   8.828427   4.000000  -0.000000   0.000000   1.853553
   8.828427   4.000000   0.000000  -0.000000   1.853553
   9.068140   4.000000   0.000000   0.000000   1.722292
   9.806424   4.000000   0.000000   0.000000   1.664591
  10.102748   4.000000   0.000000  -0.000000   1.712675
EOF
paste output/zvo_phys_Nup2_Ndown2.dat reference.dat > paste.dat
diff=`awk 'BEGIN{diff=0.0} NR>1{diff+=sqrt(($1-$6)*($1-$6))} END{printf "%8.6f", diff}' paste.dat`
test "${diff}" = "0.000000"

exit $?
