#!/bin/sh -e

mkdir -p te_dc_hubbard_square/
cd te_dc_hubbard_square
cp -rf ../te_ac_hubbard_square/output .

cat > stan.in <<EOF
model = "Hubbard"
method = "Time-Evolution"
lattice = "square"
a0w = 3
a0l = 0
a1w = 0
a1l = 3
t = 1.0
U = 10.0
nelec = 8
2Sz = 0
lanczos_max = 40
initial_iv = 1
EigenvecIO = "in"
dt = 0.01
tshift = 0.2
freq = 10.0
PumpType = "DC Laser"
VecPotW = 0.5
VecPotL = 0.5
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value: Flct
cat > reference.dat <<EOF
0.0000000000000000 7.9999999999999973 63.9999999999999787 0.2592919779061983 0.2991789411194007 0.0000000000000000 0.0000000000000000 0
0.0100000000000000 7.9999999999999725 63.9999999999997797 0.2592919972758214 0.2991789665208349 0.0000000000000000 0.0000000000000000 1
0.0200000000000000 8.0000000000000426 64.0000000000003411 0.2592920761197176 0.2991790737737922 0.0000000000000000 0.0000000000000000 2
0.0300000000000000 8.0000000000000409 64.0000000000003268 0.2592923497526811 0.2991794487124937 0.0000000000000000 0.0000000000000000 3
0.0400000000000000 7.9999999999999609 63.9999999999996874 0.2592930833455366 0.2991804545524760 0.0000000000000000 0.0000000000000000 4
0.0500000000000000 8.0000000000000604 64.0000000000004832 0.2592946613696083 0.2991826156252716 0.0000000000000000 0.0000000000000000 5
0.0600000000000000 7.9999999999999396 63.9999999999995168 0.2592975721344491 0.2991865936804917 0.0000000000000000 0.0000000000000000 6
0.0700000000000000 8.0000000000000480 64.0000000000003837 0.2593023878475342 0.2991931575554505 0.0000000000000000 0.0000000000000000 7
0.0800000000000000 8.0000000000000941 64.0000000000007532 0.2593097407486403 0.2992031472281390 0.0000000000000000 0.0000000000000000 8
0.0900000000000000 7.9999999999999494 63.9999999999995950 0.2593202959807329 0.2992174334462562 0.0000000000000000 0.0000000000000000 9
0.1000000000000000 8.0000000000000160 64.0000000000001279 0.2593347219499509 0.2992368742558751 0.0000000000000000 0.0000000000000000 10
0.1100000000000000 8.0000000000000462 64.0000000000003695 0.2593536589975938 0.2992622698354233 0.0000000000000000 0.0000000000000000 11
0.1200000000000000 8.0000000000000142 64.0000000000001137 0.2593776872552166 0.2992943170726748 0.0000000000000000 0.0000000000000000 12
0.1300000000000000 8.0000000000000444 64.0000000000003553 0.2594072945787787 0.2993335653054705 0.0000000000000000 0.0000000000000000 13
0.1400000000000000 7.9999999999999831 63.9999999999998650 0.2594428454588877 0.2993803745842311 0.0000000000000000 0.0000000000000000 14
0.1500000000000000 8.0000000000000142 64.0000000000001137 0.2594845517820078 0.2994348777113532 0.0000000000000000 0.0000000000000000 15
0.1600000000000000 8.0000000000000089 64.0000000000000711 0.2595324462726759 0.2994969471753601 0.0000000000000000 0.0000000000000000 16
0.1700000000000000 8.0000000000000586 64.0000000000004690 0.2595863593809601 0.2995661679338444 0.0000000000000000 0.0000000000000000 17
0.1800000000000000 7.9999999999999121 63.9999999999992966 0.2596459002947291 0.2996418168167667 0.0000000000000000 0.0000000000000000 18
0.1900000000000000 8.0000000000001101 64.0000000000008811 0.2597104426552898 0.2997228491278986 0.0000000000000000 0.0000000000000000 19
0.2000000000000000 8.0000000000000195 64.0000000000001563 0.2597791154401208 0.2998078928245182 0.0000000000000000 0.0000000000000000 20
0.2100000000000000 7.9999999999999334 63.9999999999994671 0.2598507993518357 0.2998952504608502 0.0000000000000000 0.0000000000000000 21
0.2200000000000000 7.9999999999999734 63.9999999999997868 0.2599241289203291 0.2999829088932743 0.0000000000000000 0.0000000000000000 22
0.2300000000000000 7.9999999999999751 63.9999999999998010 0.2599975003898758 0.3000685565705749 0.0000000000000000 0.0000000000000000 23
0.2400000000000000 7.9999999999999085 63.9999999999992681 0.2600690853274717 0.3001496080723368 0.0000000000000000 0.0000000000000000 24
0.2500000000000000 7.9999999999999920 63.9999999999999361 0.2601368497563945 0.3002232354150411 0.0000000000000000 0.0000000000000000 25
0.2600000000000000 8.0000000000000870 64.0000000000006963 0.2601985784931634 0.3002864055190630 0.0000000000000000 0.0000000000000000 26
0.2700000000000000 8.0000000000000444 64.0000000000003553 0.2602519042493618 0.3003359231209815 0.0000000000000000 0.0000000000000000 27
0.2800000000000000 8.0000000000000355 64.0000000000002842 0.2602943409547993 0.3003684783227560 0.0000000000000000 0.0000000000000000 28
0.2900000000000000 7.9999999999999867 63.9999999999998934 0.2603233206674609 0.3003806978928605 0.0000000000000000 0.0000000000000000 29
0.3000000000000000 8.0000000000000586 64.0000000000004690 0.2603362333600115 0.3003691993723551 0.0000000000000000 0.0000000000000000 30
0.3100000000000000 8.0000000000000124 64.0000000000000995 0.2603304688140688 0.3003306469912864 0.0000000000000000 0.0000000000000000 31
0.3200000000000000 7.9999999999999822 63.9999999999998579 0.2603034598123362 0.3002618083672433 0.0000000000000000 0.0000000000000000 32
0.3300000000000000 7.9999999999999734 63.9999999999997868 0.2602527257956819 0.3001596109384152 0.0000000000000000 0.0000000000000000 33
0.3400000000000000 7.9999999999999627 63.9999999999997016 0.2601759161473023 0.3000211970791873 0.0000000000000000 0.0000000000000000 34
0.3500000000000000 8.0000000000000320 64.0000000000002558 0.2600708522784705 0.2998439768578193 0.0000000000000000 0.0000000000000000 35
0.3600000000000000 7.9999999999999556 63.9999999999996447 0.2599355677195254 0.2996256774245317 0.0000000000000000 0.0000000000000000 36
0.3700000000000000 7.9999999999999796 63.9999999999998366 0.2597683454643240 0.2993643880658464 0.0000000000000000 0.0000000000000000 37
0.3800000000000000 8.0000000000000284 64.0000000000002274 0.2595677518747147 0.2990586000278845 0.0000000000000000 0.0000000000000000 38
0.3900000000000000 7.9999999999999059 63.9999999999992468 0.2593326665225564 0.2987072402987413 0.0000000000000000 0.0000000000000000 39
EOF

sed -e "1d" output/Flct.dat > flct.dat
paste flct.dat reference.dat > paste1.dat
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($2-$10)*($2-$10))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff N : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($3-$11)*($3-$11))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff N^2 : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($4-$12)*($4-$12))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff D : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($5-$13)*($5-$13))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff D^2 : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($6-$14)*($6-$14))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff Sz : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($7-$15)*($7-$15))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff Sz^2 : " ${diff}
test "${diff}" = "0.000000"

exit $?
