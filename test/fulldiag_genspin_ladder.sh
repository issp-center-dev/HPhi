#!/bin/sh -e

mkdir -p fulldiag_genspin_ladder
cd fulldiag_genspin_ladder

cat > stan.in <<EOF
L = 2
W = 2
model = "Spin"
method = "FullDiag"
lattice = "ladder"
J0 = 1.0
J1 = 1.0
2S = 3
2Sz = 0
ScaLAPACK = 1
EOF

${MPIRUNFC} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
  <H>         <N>        <Sz>       <S2>       <D>
 -18.362362   0.000000   0.000000   0.000000   0.000000
 -16.816512   0.000000   0.000000   2.000000   0.000000
 -13.741935   0.000000   0.000000   6.000000   0.000000
 -12.824555   0.000000   0.000000   2.000000   0.000000
 -12.547565   0.000000   0.000000   2.000000   0.000000
 -10.330034   0.000000   0.000000   0.000000   0.000000
  -9.774917   0.000000   0.000000   6.000000   0.000000
  -9.152730   0.000000   0.000000  12.000000   0.000000
  -9.082576   0.000000   0.000000   6.000000   0.000000
  -8.231053   0.000000   0.000000   2.000000   0.000000
  -7.254385   0.000000   0.000000   6.000000   0.000000
  -6.774917   0.000000   0.000000   6.000000   0.000000
  -6.500000   0.000000   0.000000   2.000000   0.000000
  -5.372983   0.000000   0.000000  12.000000   0.000000
  -4.768947   0.000000   0.000000   2.000000   0.000000
  -4.669966   0.000000   0.000000  -0.000000   0.000000
  -4.500000   0.000000   0.000000   6.000000   0.000000
  -4.068485   0.000000   0.000000  12.000000   0.000000
  -3.067764   0.000000   0.000000  20.000000   0.000000
  -2.415755   0.000000   0.000000  12.000000   0.000000
  -2.225083   0.000000   0.000000   6.000000   0.000000
  -1.745615   0.000000   0.000000   6.000000   0.000000
  -1.500000   0.000000   0.000000  12.000000   0.000000
  -1.500000   0.000000   0.000000  12.000000   0.000000
  -0.584245   0.000000   0.000000  12.000000   0.000000
  -0.452435   0.000000   0.000000   2.000000   0.000000
  -0.175445   0.000000   0.000000   2.000000   0.000000
   0.082576   0.000000   0.000000   6.000000   0.000000
   0.500000   0.000000   0.000000  20.000000   0.000000
   0.774917   0.000000   0.000000   6.000000   0.000000
   1.068485   0.000000   0.000000  12.000000   0.000000
   2.372983   0.000000   0.000000  12.000000   0.000000
   2.500000   0.000000   0.000000  20.000000   0.000000
   2.500000   0.000000   0.000000  20.000000   0.000000
   3.362362   0.000000   0.000000  -0.000000   0.000000
   3.816512   0.000000   0.000000   2.000000   0.000000
   4.500000   0.000000   0.000000  22.422873   0.000000
   4.500000   0.000000   0.000000  27.577127   0.000000
   4.741935   0.000000   0.000000   6.000000   0.000000
   6.152730   0.000000   0.000000  12.000000   0.000000
   7.500000   0.000000   0.000000  30.000000   0.000000
   8.067764   0.000000   0.000000  20.000000   0.000000
  10.500000   0.000000   0.000000  30.000000   0.000000
  13.500000   0.000000   0.000000  42.000000   0.000000
EOF
paste output/zvo_phys_Nup2_Ndown2.dat reference.dat > paste.dat
diff=`awk '
BEGIN{diff=0.0} 
NR>1{diff+=sqrt(($1-$6)*($1-$6))} 
END{printf "%8.6f", diff/NR}
' paste.dat`
test "${diff}" = "0.000000"

exit $?
