#!/bin/sh -e

mkdir -p lobcg_spin_kagome/
cd lobcg_spin_kagome

cat > stan.in <<EOF
a0w = 1
a0l = 1
a1w = -1
a1l = 2
model = "Spin"
method = "CG"
lattice = "kagome"
J0 = 1.0
J1 = 0.5
J2 = 0.7
J'=0.2
2Sz = 1
exct = 2
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value

cat > reference.dat <<EOF
 0
  -3.6523534273467710
  0.0000000000000000
  0.5000000000000000

 1
  -3.3180023889678378
  0.0000000000000000
  0.5000000000000000
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
   0.2401520394 0.0000000000
   0.7598479606 0.0000000000
   0.6176310957 0.0000000000
   0.3823689043 0.0000000000
   0.4755501983 0.0000000000
   0.5244498017 0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.3492166256 0.0000000000
   0.6507833744 0.0000000000
   0.5863656810 0.0000000000
   0.4136343190 0.0000000000
   0.3977512318 0.0000000000
   0.6022487682 0.0000000000
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
   0.2401520394 0.0000000000
   0.0000000000 0.0000000000
   0.1156788636 0.0000000000
   0.1244731758 0.0000000000
   0.0712843477 0.0000000000
   0.1688676917 0.0000000000
   0.0725315457 0.0000000000
   0.1676204937 0.0000000000
   0.1156788636 0.0000000000
   0.1244731758 0.0000000000
   0.0732622437 0.0000000000
   0.1668897957 0.0000000000
   0.0725315457 0.0000000000
   0.1676204937 0.0000000000
   0.1282043606 0.0000000000
   0.1119476788 0.0000000000
   0.0712843477 0.0000000000
   0.1688676917 0.0000000000
   0.2401520394 0.0000000000
   -0.1264254079 -0.0000000000
   -0.0731335424 0.0000000000
   0.1647590126 -0.0000000000
   -0.1264254079 -0.0000000000
   -0.0691777503 0.0000000000
   0.1647590126 -0.0000000000
   -0.1013744138 -0.0000000000
   -0.0731335424 0.0000000000
   0.7598479606 0.0000000000
   -0.1264254079 0.0000000000
   -0.0731335424 -0.0000000000
   0.1647590126 0.0000000000
   -0.1264254079 0.0000000000
   -0.0691777503 -0.0000000000
   0.1647590126 0.0000000000
   -0.1013744138 0.0000000000
   -0.0731335424 -0.0000000000
   0.0000000000 0.0000000000
   0.7598479606 0.0000000000
   0.5019522321 0.0000000000
   0.2578957285 0.0000000000
   0.4042658507 0.0000000000
   0.3555821100 0.0000000000
   0.1676204937 0.0000000000
   0.5922274669 0.0000000000
   0.5019522321 0.0000000000
   0.2578957285 0.0000000000
   0.4022879546 0.0000000000
   0.3575600060 0.0000000000
   0.1676204937 0.0000000000
   0.5922274669 0.0000000000
   0.4894267350 0.0000000000
   0.2704212256 0.0000000000
   0.4042658507 0.0000000000
   0.3555821100 0.0000000000
   0.1156788636 0.0000000000
   0.5019522321 0.0000000000
   0.6176310957 0.0000000000
   0.0000000000 0.0000000000
   0.1859970165 0.0000000000
   0.4316340792 0.0000000000
   0.1282043606 0.0000000000
   0.4894267350 0.0000000000
   0.4441917559 0.0000000000
   0.1734393398 0.0000000000
   0.1859970165 0.0000000000
   0.4316340792 0.0000000000
   0.1156788636 0.0000000000
   0.5019522321 0.0000000000
   0.4441917559 0.0000000000
   0.1734393398 0.0000000000
   0.2329536545 0.0000000000
   0.3846774411 0.0000000000
   -0.1264254079 0.0000000000
   0.6176310957 0.0000000000
   -0.2211872610 -0.0000000000
   -0.1013744138 0.0000000000
   0.1531213204 0.0000000000
   -0.2211872610 -0.0000000000
   -0.1264254079 0.0000000000
   0.1531213204 0.0000000000
   -0.1272739849 -0.0000000000
   -0.1264254079 -0.0000000000
   0.3823689043 0.0000000000
   -0.2211872610 0.0000000000
   -0.1013744138 -0.0000000000
   0.1531213204 -0.0000000000
   -0.2211872610 0.0000000000
   -0.1264254079 -0.0000000000
   0.1531213204 -0.0000000000
   -0.1272739849 0.0000000000
   0.1244731758 0.0000000000
   0.2578957285 0.0000000000
   0.0000000000 0.0000000000
   0.3823689043 0.0000000000
   0.2895531818 0.0000000000
   0.0928157225 0.0000000000
   0.1119476788 0.0000000000
   0.2704212256 0.0000000000
   0.1734393398 0.0000000000
   0.2089295646 0.0000000000
   0.2895531818 0.0000000000
   0.0928157225 0.0000000000
   0.1244731758 0.0000000000
   0.2578957285 0.0000000000
   0.1734393398 0.0000000000
   0.2089295646 0.0000000000
   0.2425965438 0.0000000000
   0.1397723605 0.0000000000
   0.0712843477 0.0000000000
   0.4042658507 0.0000000000
   0.1859970165 0.0000000000
   0.2895531818 0.0000000000
   0.4755501983 0.0000000000
   0.0000000000 0.0000000000
   0.0712843477 0.0000000000
   0.4042658507 0.0000000000
   0.2329536545 0.0000000000
   0.2425965438 0.0000000000
   0.3029359842 0.0000000000
   0.1726142141 0.0000000000
   0.0732622437 0.0000000000
   0.4022879546 0.0000000000
   0.1859970165 0.0000000000
   0.2895531818 0.0000000000
   0.3029359842 0.0000000000
   0.1726142141 0.0000000000
   -0.0731335424 -0.0000000000
   -0.2211872610 0.0000000000
   0.4755501983 0.0000000000
   -0.0731335424 -0.0000000000
   -0.1272739849 0.0000000000
   0.1547715718 -0.0000000000
   -0.0691777503 -0.0000000000
   -0.2211872610 0.0000000000
   0.1547715718 0.0000000000
   -0.0731335424 0.0000000000
   -0.2211872610 -0.0000000000
   0.5244498017 0.0000000000
   -0.0731335424 0.0000000000
   -0.1272739849 -0.0000000000
   0.1547715718 0.0000000000
   -0.0691777503 0.0000000000
   -0.2211872610 -0.0000000000
   0.1547715718 -0.0000000000
   0.1688676917 0.0000000000
   0.3555821100 0.0000000000
   0.4316340792 0.0000000000
   0.0928157225 0.0000000000
   0.0000000000 0.0000000000
   0.5244498017 0.0000000000
   0.1688676917 0.0000000000
   0.3555821100 0.0000000000
   0.3846774411 0.0000000000
   0.1397723605 0.0000000000
   0.1726142141 0.0000000000
   0.3518355876 0.0000000000
   0.1668897957 0.0000000000
   0.3575600060 0.0000000000
   0.4316340792 0.0000000000
   0.0928157225 0.0000000000
   0.1726142141 0.0000000000
   0.3518355876 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.3492166256 0.0000000000
   0.0000000000 0.0000000000
   0.1724648396 0.0000000000
   0.1767517860 0.0000000000
   0.1258699742 0.0000000000
   0.2233466513 0.0000000000
   0.0591472836 0.0000000000
   0.2900693419 0.0000000000
   0.1724648360 0.0000000000
   0.1767517895 0.0000000000
   0.1307800638 0.0000000000
   0.2184365617 0.0000000000
   0.0591473174 0.0000000000
   0.2900693082 0.0000000000
   0.2019056095 0.0000000000
   0.1473110160 0.0000000000
   0.1258699525 0.0000000000
   0.2233466731 0.0000000000
   0.3492166256 0.0000000000
   -0.2286388544 0.0000002035
   0.2108582745 -0.0000002451
   0.2860664929 -0.0000004462
   -0.2286388559 0.0000001932
   0.2141602863 -0.0000001482
   0.2860665701 -0.0000004999
   -0.1952469388 0.0000002245
   0.2108582581 -0.0000002312
   0.6507833744 0.0000000000
   -0.2286388544 -0.0000002035
   0.2108582745 0.0000002451
   0.2860664929 0.0000004462
   -0.2286388559 -0.0000001932
   0.2141602863 0.0000001482
   0.2860665701 0.0000004999
   -0.1952469388 -0.0000002245
   0.2108582581 0.0000002312
   0.0000000000 0.0000000000
   0.6507833744 0.0000000000
   0.4139008414 0.0000000000
   0.2368825330 0.0000000000
   0.2718812576 0.0000000000
   0.3789021169 0.0000000000
   0.2900689138 0.0000000000
   0.3607144607 0.0000000000
   0.4139008620 0.0000000000
   0.2368825125 0.0000000000
   0.2669712205 0.0000000000
   0.3838121540 0.0000000000
   0.2900691029 0.0000000000
   0.3607142716 0.0000000000
   0.3844601059 0.0000000000
   0.2663232685 0.0000000000
   0.2718811938 0.0000000000
   0.3789021807 0.0000000000
   0.1724648396 0.0000000000
   0.4139008414 0.0000000000
   0.5863656810 0.0000000000
   0.0000000000 0.0000000000
   0.1251669203 0.0000000000
   0.4611987607 0.0000000000
   0.2019053228 0.0000000000
   0.3844603582 0.0000000000
   0.3901034755 0.0000000000
   0.1962622055 0.0000000000
   0.1251669510 0.0000000000
   0.4611987300 0.0000000000
   0.1724647074 0.0000000000
   0.4139009736 0.0000000000
   0.3901034799 0.0000000000
   0.1962622011 0.0000000000
   0.1817213465 0.0000000000
   0.4046443346 0.0000000000
   -0.2286388544 -0.0000002035
   0.5863656810 0.0000000000
   -0.3001360026 0.0000000447
   -0.1952469042 0.0000001009
   0.1761602406 0.0000000046
   -0.3001360058 -0.0000000547
   -0.2286388543 0.0000001592
   0.1761602452 -0.0000000249
   -0.2040837858 0.0000000158
   -0.2286388544 0.0000002035
   0.4136343190 0.0000000000
   -0.3001360026 -0.0000000447
   -0.1952469042 -0.0000001009
   0.1761602406 -0.0000000046
   -0.3001360058 0.0000000547
   -0.2286388543 -0.0000001592
   0.1761602452 0.0000000249
   -0.2040837858 -0.0000000158
   0.1767517860 0.0000000000
   0.2368825330 0.0000000000
   0.0000000000 0.0000000000
   0.4136343190 0.0000000000
   0.2725843115 0.0000000000
   0.1410500075 0.0000000000
   0.1473108746 0.0000000000
   0.2663234444 0.0000000000
   0.1962622225 0.0000000000
   0.2173720965 0.0000000000
   0.2725843332 0.0000000000
   0.1410499857 0.0000000000
   0.1767517128 0.0000000000
   0.2368826062 0.0000000000
   0.1962622355 0.0000000000
   0.2173720835 0.0000000000
   0.2160297998 0.0000000000
   0.1976045192 0.0000000000
   0.1258699742 0.0000000000
   0.2718812576 0.0000000000
   0.1251669203 0.0000000000
   0.2725843115 0.0000000000
   0.3977512318 0.0000000000
   0.0000000000 0.0000000000
   0.1258698342 0.0000000000
   0.2718813976 0.0000000000
   0.1817214001 0.0000000000
   0.2160298317 0.0000000000
   0.1893393551 0.0000000000
   0.2084118767 0.0000000000
   0.1307799742 0.0000000000
   0.2669712576 0.0000000000
   0.1251669307 0.0000000000
   0.2725843011 0.0000000000
   0.1893393065 0.0000000000
   0.2084119253 0.0000000000
   0.2108582745 0.0000002451
   -0.3001360026 -0.0000000447
   0.3977512318 0.0000000000
   0.2108582110 -0.0000000666
   -0.2040837868 -0.0000000374
   0.1921102694 0.0000000704
   0.2141602495 -0.0000001123
   -0.3001360019 0.0000000009
   0.1921102501 0.0000000151
   0.2108582745 -0.0000002451
   -0.3001360026 0.0000000447
   0.6022487682 0.0000000000
   0.2108582110 0.0000000666
   -0.2040837868 0.0000000374
   0.1921102694 -0.0000000704
   0.2141602495 0.0000001123
   -0.3001360019 -0.0000000009
   0.1921102501 -0.0000000151
   0.2233466513 0.0000000000
   0.3789021169 0.0000000000
   0.4611987607 0.0000000000
   0.1410500075 0.0000000000
   0.0000000000 0.0000000000
   0.6022487682 0.0000000000
   0.2233463632 0.0000000000
   0.3789024050 0.0000000000
   0.4046442979 0.0000000000
   0.1976044703 0.0000000000
   0.2084119292 0.0000000000
   0.3938368390 0.0000000000
   0.2184364460 0.0000000000
   0.3838123222 0.0000000000
   0.4611987847 0.0000000000
   0.1410499835 0.0000000000
   0.2084118398 0.0000000000
   0.3938369284 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
