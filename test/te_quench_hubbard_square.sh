#!/bin/sh -e

mkdir -p te_quench_hubbard_square/
cd te_quench_hubbard_square
cp -rf ../te_ac_hubbard_square/output .

cat > stan.in <<EOF
model = "Hubbard"
method = "Time-Evolution"
lattice = "square"
a0w = 3
a0l = 0
a1w = 0
a1l = 3
t = 1.0
U = 10.0
nelec = 8
2Sz = 0
lanczos_max = 40
initial_iv = 1
EigenvecIO = "in"
dt = 0.01
tshift = 0.2
freq = 10.0
PumpType = "Quench"
UQuench = 10.0
VecPotW = 0.5
VecPotL = 0.5
EOF

${MPIRUN} ../../src/HPhi -s stan.in

# Check value: Flct
cat > reference.dat <<EOF
0.0000000000000000 7.9999999999999973 63.9999999999999787 0.2592919779061983 0.2991789411194007 0.0000000000000000 0.0000000000000000 0
0.0100000000000000 8.0000000000000053 64.0000000000000426 0.2563903729600265 0.2953890011263764 0.0000000000000000 0.0000000000000000 1
0.0200000000000000 8.0000000000000053 64.0000000000000426 0.2478240047137538 0.2842582534647958 0.0000000000000000 0.0000000000000000 2
0.0300000000000000 7.9999999999999982 63.9999999999999858 0.2340013047929242 0.2664812252605896 0.0000000000000000 0.0000000000000000 3
0.0400000000000000 7.9999999999999982 63.9999999999999858 0.2155803324217412 0.2431430379040411 0.0000000000000000 0.0000000000000000 4
0.0500000000000000 7.9999999999999938 63.9999999999999503 0.1934360465851444 0.2156214399361324 0.0000000000000000 0.0000000000000000 5
0.0600000000000000 8.0000000000000036 64.0000000000000284 0.1686169337819143 0.1854690725192820 0.0000000000000000 0.0000000000000000 6
0.0700000000000000 7.9999999999999991 63.9999999999999929 0.1422932622958887 0.1542912855837608 0.0000000000000000 0.0000000000000000 7
0.0800000000000000 8.0000000000000000 64.0000000000000000 0.1156996470921472 0.1236342249570670 0.0000000000000000 0.0000000000000000 8
0.0900000000000000 7.9999999999999956 63.9999999999999645 0.0900748709825198 0.0948949379434906 0.0000000000000000 0.0000000000000000 9
0.1000000000000000 7.9999999999999964 63.9999999999999716 0.0666020081335804 0.0692605334062274 0.0000000000000000 0.0000000000000000 10
0.1100000000000000 7.9999999999999973 63.9999999999999787 0.0463518359666918 0.0476779226655731 0.0000000000000000 0.0000000000000000 11
0.1200000000000000 8.0000000000000053 64.0000000000000426 0.0302323106266167 0.0308504163265171 0.0000000000000000 0.0000000000000000 12
0.1300000000000000 8.0000000000000000 64.0000000000000000 0.0189465362734996 0.0192534275307543 0.0000000000000000 0.0000000000000000 13
0.1400000000000000 8.0000000000000000 64.0000000000000000 0.0129612015073237 0.0131594299266478 0.0000000000000000 0.0000000000000000 14
0.1500000000000000 8.0000000000000000 64.0000000000000000 0.0124869126537819 0.0126624360367095 0.0000000000000000 0.0000000000000000 15
0.1600000000000000 8.0000000000000036 64.0000000000000284 0.0174712506758222 0.0176944505948459 0.0000000000000000 0.0000000000000000 16
0.1700000000000000 7.9999999999999991 63.9999999999999929 0.0276047442098348 0.0280300608939232 0.0000000000000000 0.0000000000000000 17
0.1800000000000000 7.9999999999999982 63.9999999999999858 0.0423393139828440 0.0432797122809254 0.0000000000000000 0.0000000000000000 18
0.1900000000000000 8.0000000000000053 64.0000000000000426 0.0609181318835332 0.0628763259860979 0.0000000000000000 0.0000000000000000 19
0.2000000000000000 8.0000000000000018 64.0000000000000142 0.0824152790733758 0.0860628680941180 0.0000000000000000 0.0000000000000000 20
0.2100000000000000 8.0000000000000000 64.0000000000000000 0.1057831086224332 0.1118896412525637 0.0000000000000000 0.0000000000000000 21
0.2200000000000000 7.9999999999999973 63.9999999999999787 0.1299048441950761 0.1392291850200233 0.0000000000000000 0.0000000000000000 22
0.2300000000000000 8.0000000000000018 64.0000000000000142 0.1536496988560567 0.1668138969425675 0.0000000000000000 0.0000000000000000 23
0.2400000000000000 7.9999999999999991 63.9999999999999929 0.1759276934376015 0.1932973694350249 0.0000000000000000 0.0000000000000000 24
0.2500000000000000 8.0000000000000089 64.0000000000000711 0.1957414012117060 0.2173357950363845 0.0000000000000000 0.0000000000000000 25
0.2600000000000000 8.0000000000000000 64.0000000000000000 0.2122320450087564 0.2376815496203420 0.0000000000000000 0.0000000000000000 26
0.2700000000000000 8.0000000000000036 64.0000000000000284 0.2247177145149254 0.2532780664160782 0.0000000000000000 0.0000000000000000 27
0.2800000000000000 7.9999999999999973 63.9999999999999787 0.2327219351476975 0.2633439637619052 0.0000000000000000 0.0000000000000000 28
0.2900000000000000 7.9999999999999973 63.9999999999999787 0.2359913763030389 0.2674353244256487 0.0000000000000000 0.0000000000000000 29
0.3000000000000000 7.9999999999999929 63.9999999999999432 0.2345020994428109 0.2654778781128359 0.0000000000000000 0.0000000000000000 30
0.3100000000000000 7.9999999999999991 63.9999999999999929 0.2284543749938885 0.2577650818480766 0.0000000000000000 0.0000000000000000 31
0.3200000000000000 7.9999999999999982 63.9999999999999858 0.2182567005585625 0.2449229441903256 0.0000000000000000 0.0000000000000000 32
0.3300000000000000 7.9999999999999982 63.9999999999999858 0.2045001940892239 0.2278470252080677 0.0000000000000000 0.0000000000000000 33
0.3400000000000000 8.0000000000000000 64.0000000000000000 0.1879249837799580 0.2076205707004234 0.0000000000000000 0.0000000000000000 34
0.3500000000000000 7.9999999999999991 63.9999999999999929 0.1693805499535526 0.1854246410309404 0.0000000000000000 0.0000000000000000 35
0.3600000000000000 8.0000000000000089 64.0000000000000711 0.1497821820532435 0.1624511335116076 0.0000000000000000 0.0000000000000000 36
0.3700000000000000 7.9999999999999956 63.9999999999999645 0.1300657951890386 0.1398278898106760 0.0000000000000000 0.0000000000000000 37
0.3800000000000000 7.9999999999999956 63.9999999999999645 0.1111433137722151 0.1185620581777767 0.0000000000000000 0.0000000000000000 38
0.3900000000000000 8.0000000000000053 64.0000000000000426 0.0938606896301851 0.0995041909835936 0.0000000000000000 0.0000000000000000 39
EOF
sed -e "1d" output/Flct.dat > flct.dat
paste flct.dat reference.dat > paste1.dat
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($2-$10)*($2-$10))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff N : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($3-$11)*($3-$11))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff N^2 : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($4-$12)*($4-$12))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff D : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($5-$13)*($5-$13))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff D^2 : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($6-$14)*($6-$14))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff Sz : " ${diff}
test "${diff}" = "0.000000"
diff=`awk 'BEGIN{diff=0.0} {diff+=sqrt(($7-$15)*($7-$15))} END{printf "%8.6f", diff/NR}' paste1.dat`
echo "Diff Sz^2 : " ${diff}
test "${diff}" = "0.000000"

exit $?
